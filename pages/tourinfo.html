<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/tourinfo.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services,clusterer,drawing"
    ></script>

    <script src="../js/key.js"></script>
    <link rel="stylesheet" href="../css/common.css" />
    <title>지역관광정보</title>
  </head>

  <body>
    <!-- Header -->
    <header>
      <div class="header-container">
        <div id="logo"><a href="/">Enjoy Trip</a></div>
        <div id="menulist">
          <div id="menuitem"><a href="tourinfo.html">지역별여행지</a></div>
          <div id="menuitem"><a href="plan.html">나의여행계획</a></div>
          <div id="menuitem"><a href="board.html">공유게시판</a></div>
          <div id="menuitem"><a href="signup.html">회원가입</a></div>
          <div id="menuitem"><a href="login.html">로그인</a></div>
        </div>
      </div>
    </header>
    <!-- Contents -->
    <section>
      <!-- ment -->
      <div class="ment box">
        <h2>여행 가고 싶은 지역을</h2>
        <h2>검색해보세요.</h2>
      </div>
      <!-- searchBar -->
      <div id="searchBox" class="box">
        <input id="searchInput" type="text" placeholder="무엇이든 찾아보세요" /><img
          id="searchImg"
          src="../img/tourinfo/magnifying-glass-solid.png"
          alt=""
        />
      </div>

      <form id="search-form" action="#">
        <select name="search-area" id="search-area" class="selectBox">
          <option value="-1">지역</option>
        </select>
        <select name="search-city" id="search-city" class="selectBox">
          <option value="-1">시군구</option>
        </select>
        <select name="search-content-id" id="search-content-id" class="selectBox">
          <option value="">관광지 유형</option>
          <option value="">관광지</option>
          <option value="">문화시설</option>
          <option value="">축제공연행사</option>
          <option value="">여행코스</option>
          <option value="">레포츠</option>
          <option value="">숙박</option>
          <option value="">쇼핑</option>
          <option value="">음식점</option>
        </select>
        <input type="button" value="검색" />
      </form>

      <!-- kakao map -->
      <div id="mapBox">
        <div id="map"></div>
      </div>

      <div id="youtubeBox" class="box">
        <p>바로 유튜브에서 찾아볼까요?</p>
        <p>선택한 관광지의 영상을 확인할 수 있어요.</p>
        <div id="btnBox">
          <button id="utBtn">검색하기</button>
        </div>
        <div id="flexBox"></div>
      </div>
    </section>
    <!-- footer -->
    <footer>
      <div class="footer-container">
        <div>
          <img src="../img/ssafy_logo.png" alt="" />
        </div>
        <div id="footer-right">
          <p>이용약관 | 개인정보방침</p>
          <div>
            본 사이트의 콘텐츠는 저작권법의 보호를 받는 바 무단 전재, 복사, 배포 등을 금합니다.
          </div>
          <div>Copyright © SAMSUNG All Rights Reserved.</div>
        </div>
      </div>
    </footer>
    <!-- kakao api연결 -->
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f969680d19602de1fea5ade9c6d7e784"></script>
    <script>
      function sleep(ms) {
        const wakeUpTime = Date.now() + ms;
        while (Date.now() < wakeUpTime) {}
      }
      // 모든 지역정보를 가져올 url설정(공공데이터포털)
      let areaUrl =
        "https://apis.data.go.kr/B551011/KorService1/areaCode1?serviceKey=" +
        serviceKey +
        "&numOfRows=20&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json";
      fetch(areaUrl)
        .then((response) => response.json())
        .then((data) => makeOption(data));

      // 옵션에 값 채우기!
      function makeOption(data) {
        // 지역을 선택한 상황
        let areas = data.response.body.items.item;
        let sel = document.getElementById("search-area");
        areas.forEach((area) => {
          let opt = document.createElement("option");
          opt.setAttribute("value", area.code);
          opt.setAttribute("class", "opAreas");
          opt.appendChild(document.createTextNode(area.name));
          sel.appendChild(opt);
        });
      }

      // ===========지역변하면 시군구 받아오기======================
      document.querySelector("#search-area").addEventListener("change", (e) => {
        let subOptionsLen = document.querySelector("#search-city").options.length;
        let target = e.target.value;
        // 검색하면됨
        let regionUrl =
          "https://apis.data.go.kr/B551011/KorService1/areaCode1?serviceKey=" +
          serviceKey +
          `&numOfRows=20&pageNo=1&MobileOS=ETC&MobileApp=AppTest&areaCode=${target}&_type=json`;
        fetch(regionUrl)
          .then((response) => response.json())
          .then((data) => makeSubOption(data));
      });

      function makeSubOption(data) {
        let citys = data.response.body.items.item;
        // console.log(city);
        let sel = document.getElementById("search-city");
        // 이전에 있던 값 지우기.
        sel.innerHTML = '<option value="-1">시군구</option>';
        citys.forEach((city) => {
          let opt = document.createElement("option");
          opt.setAttribute("value", city.code);
          opt.setAttribute("class", "opcity");
          opt.appendChild(document.createTextNode(city.name));
          sel.appendChild(opt);
        });
      }

      // =======================================

      // 선택한 지역의 시군구 가져오기.
      function makeCityOption() {}
      // KAKAO MAP API
      var container = document.getElementById("map");
      var options = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),
        level: 3,
      };

      var map = new kakao.maps.Map(container, options);

      // HTML5의 geolocation으로 사용할 수 있는지 확인합니다
      if (navigator.geolocation) {
        // GeoLocation을 이용해서 접속 위치를 얻어옵니다
        navigator.geolocation.getCurrentPosition(function (position) {
          var lat = position.coords.latitude, // 위도
            lon = position.coords.longitude; // 경도

          var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
            message = '<p style="padding:5px; position: relative; left: 45px;">현 위치</p>'; // 인포윈도우에 표시될 내용입니다

          // 마커와 인포윈도우를 표시합니다
          displayMarker(locPosition, message);
        });
      } else {
        // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

        var locPosition = new kakao.maps.LatLng(33.450701, 126.570667),
          message = "geolocation을 사용할수 없어요..";

        displayMarker(locPosition, message);
      }

      // 지도에 마커와 인포윈도우를 표시하는 함수입니다
      function displayMarker(locPosition, message) {
        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
          map: map,
          position: locPosition,
        });

        var iwContent = message, // 인포윈도우에 표시할 내용
          iwRemoveable = true;

        // 인포윈도우를 생성합니다
        var infowindow = new kakao.maps.InfoWindow({
          content: iwContent,
          removable: iwRemoveable,
        });

        // 인포윈도우를 마커위에 표시합니다
        infowindow.open(map, marker);

        // 지도 중심좌표를 접속위치로 변경합니다
        map.setCenter(locPosition);
      }
    </script>
  </body>
</html>
